<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Các tệp CSS cần thiết cho DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="~/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="~/assets/css/linearicons.css">
    <link rel="stylesheet" href="~/assets/css/animate.css">
    <link rel="stylesheet" href="~/assets/css/flaticon.css">
    <link rel="stylesheet" href="~/assets/css/slick.css">
    <link rel="stylesheet" href="~/assets/css/slick-theme.css">
    <link rel="stylesheet" href="~/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/assets/css/bootsnav.css">
    <link rel="stylesheet" href="~/assets/css/style.css">
    <link rel="stylesheet" href="~/assets/css/responsive.css">
    <!-- Thêm thư viện jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Thêm Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

    <!-- Thêm CSS của Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

</head>

<body>
    @Html.Partial("Header")
    <section id="statistics" class="statistics" style="margin-left:-30%;width:160%;height:150px">
        <div class="container">
            <div class="statistics-counter">
                <div class="col-md-3 col-sm-6">
                    <div class="single-ststistics-box">
                        <div class="statistics-content">
                            <div class="counter" style="font-size:45px;margin-right:-288%">Các Sân Đã Đặt </div>
                        </div><!--/.statistics-content-->
                    </div><!--/.single-ststistics-box-->
                </div><!--/.col-->
            </div><!--/.statistics-counter-->
        </div><!--/.container-->

    </section><!--/.counter-->
    <h2 style="text-align:center;margin:10px;font-size:30px;font-weight:bold">Danh Sách Các Sân Đã Đặt</h2>
    @if (Model != null && Model.Count > 0)
    {
    <table id="bookingTable" class="table table-striped table-bordered table-hover rounded">
    <thead class="table-dark">
        <tr>
            <th>Tên Sân</th>
            <th>Sân Phụ</th>
            <th>Địa Chỉ</th>
            <th>Số Tiền</th>
            <th>Chủ Sân</th>
            <th>Bắt Đầu</th>
            <th>Kết Thúc</th>
            <th>Mô Tả</th>
            <th>Ngày Đặt</th>
            <th>Trạng Thái</th>
            <th>Hành Động</th> <!-- Cột Hành động -->
        </tr>
    </thead>
    <tbody>
        @foreach (var booking in Model)
        {
            <tr>
                <td>@booking.CourtName</td>
                <td>@booking.SubCourtName</td>
                <td>@booking.Address</td>
                <td class="text-right">@booking.PricePerHour</td>
                <td>@booking.FullName</td>
                <td class="text-center">@booking.StartTime?.ToString("yyyy-MM-dd HH:mm:ss")</td>
                <td class="text-center">@booking.EndTime?.ToString("yyyy-MM-dd HH:mm:ss")</td>
                <td>@booking.Description</td>
                <td class="text-center">@booking.CreateDate</td>
                <td>@booking.Status</td>
                <td class="text-center">
                    @if (booking.Status == "Pending")
                    {
                                <button class="btn btn-danger" data-booking-id="@booking.BookingId">Hủy Lịch</button>


                    }
                    @if (booking.Status == "Cancelled")
                    {
                                <span style="color:red">Đã Hủy</span> <!-- Hiển thị thông báo khi trạng thái là Confirmed -->
                    }
                            @if (booking.Status == "Confirmed")
                    {
                                <span style="color:forestgreen">Đã Xác Nhận</span> <!-- Hiển thị thông báo khi trạng thái là Confirmed -->
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

    }
    else
    {
        <p>Không có booking nào được tìm thấy.</p>
    }

    <footer id="footer" class="footer">
        <div class="container">
            <div class="footer-menu">
                <div class="row">
                    <div class="col-sm-3">
                        <div class="navbar-header">
                            <a class="navbar-brand" href="index.html">list<span>race</span></a>
                        </div><!--/.navbar-header-->
                    </div>
                    <div class="col-sm-9">
                        <ul class="footer-menu-item">
                            <li class="scroll"><a href="#works">how it works</a></li>
                            <li class="scroll"><a href="#explore">explore</a></li>
                            <li class="scroll"><a href="#reviews">review</a></li>
                            <li class="scroll"><a href="#blog">blog</a></li>
                            <li class="scroll"><a href="#contact">contact</a></li>
                            <li class=" scroll"><a href="#contact">my account</a></li>
                        </ul><!--/.nav -->
                    </div>
                </div>
            </div>
            <div class="hm-footer-copyright">
                <div class="row">
                    <div class="col-sm-5">
                        <p>
                            &copy;copyright. designed and developed by <a href="https://www.themesine.com/">themesine</a>
                        </p><!--/p-->
                    </div>
                    <div class="col-sm-7">
                        <div class="footer-social">
                            <span><i class="fa fa-phone"> +1  (222) 777 8888</i></span>
                            <a href="#"><i class="fa fa-facebook"></i></a>
                            <a href="#"><i class="fa fa-twitter"></i></a>
                            <a href="#"><i class="fa fa-linkedin"></i></a>
                            <a href="#"><i class="fa fa-google-plus"></i></a>
                        </div>
                    </div>
                </div>

            </div><!--/.hm-footer-copyright-->
        </div><!--/.container-->

        <div id="scroll-Top">
            <div class="return-to-top">
                <i class="fa fa-angle-up " id="scroll-top" data-toggle="tooltip" data-placement="top" title="" data-original-title="Back to Top" aria-hidden="true"></i>
            </div>

        </div><!--/.scroll-Top-->

    </footer><!--/.footer-->
    <!-- Thêm các file JS cần thiết cho jQuery và DataTables -->
    <!-- Tải jQuery từ một CDN khác -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Tải DataTables từ một CDN khác -->
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script>
        $('.btn-danger').on('click', function () {
            var bookingId = $(this).data('booking-id');
            console.log("Booking ID: " + bookingId); // Kiểm tra giá trị của bookingId

            var confirmationMessage = "Bạn có thực sự muốn hủy lịch? \n\n" +
                "Chính sách hoàn tiền: \n" +
                "1. Hủy sân trước 12 tiếng hoàn 100% tiền. \n" +
                "2. Hủy sân trước 6 tiếng hoàn 50% tiền. \n" +
                "3. Hủy sân trước 2 tiếng không hoàn tiền.";
-0
            var userConfirmed = confirm(confirmationMessage);

            if (userConfirmed) {
                $.ajax({
                    url: '/api/booking/cancel-booking', // URL API
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ bookingId: bookingId }), // Gửi bookingId
                    success: function (response) {
                        alert('Hủy lịch thành công! ' + response.refundMessage);
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        alert('Có lỗi xảy ra. Vui lòng thử lại.');
                        console.log(xhr.responseText);  // Xem lỗi chi tiết trong console
                    }
                });
            }
        });
    </script>


</body>
